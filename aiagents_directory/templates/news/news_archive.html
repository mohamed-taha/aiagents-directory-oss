{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }} | AiAgents.Directory{% endblock %}

{% block meta_basic %}
    <link rel="canonical" href="{{ request.build_absolute_uri }}" />
    <meta name="description" content="{{ meta_description }}">

    {% if page_obj.has_previous %}
        <link rel="prev" href="?page={{ page_obj.previous_page_number }}">
    {% endif %}

    {% if page_obj.has_next %}
        <link rel="next" href="?page={{ page_obj.next_page_number }}">
    {% endif %}
{% endblock %}

{% block og_title %}{{ page_title }} | AiAgents.Directory{% endblock %}
{% block og_description %}{{ meta_description }}{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page_title }}",
  "description": "{{ meta_description }}",
  "url": "{{ request.build_absolute_uri }}",
  "publisher": {
    "@type": "Organization",
    "name": "AiAgents.Directory",
    "url": "https://aiagents.directory"
  },
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ total_count }},
    "itemListElement": [
      {% for article in articles %}
      {
        "@type": "ListItem",
        "position": {{ forloop.counter }},
        "item": {
          "@type": "NewsArticle",
          "headline": "{{ article.title|escapejs }}",
          "url": "{{ article.url }}",
          "datePublished": "{{ article.published_at|date:'c' }}",
          "description": "{{ article.summary|escapejs|truncatechars:200 }}",
          "publisher": {
            "@type": "Organization",
            "name": "{{ article.source_name }}"
          }
        }
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]
  }
}
</script>
{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
    <div class="text-center max-w-3xl mx-auto">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 text-gray-900 dark:text-white">
            {{ page_title }}
        </h1>
        <p class="text-base sm:text-lg text-gray-600 dark:text-gray-300 mb-6 sm:mb-8 px-4">
            Stay updated with the latest news about AI agents, autonomous AI, and automation tools.
        </p>
    </div>
</div>

<!-- Main Content -->
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 sm:pb-16 lg:pb-20">
    <!-- Time Filter Tabs -->
    <div class="flex flex-wrap gap-2 sm:gap-4 mb-6 sm:mb-8">
        <a href="{% url 'news_archive' %}"
           class="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-sm hover:shadow-md text-sm sm:text-base
                  {% if time_filter == 'all' %}bg-accent-500 text-white hover:bg-accent-600{% else %}bg-white dark:bg-dark-800 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-dark-700 hover:text-accent-500 dark:hover:text-accent-500 border border-gray-200 dark:border-dark-700{% endif %}
                  transition-all duration-200">
            All News
        </a>
        <a href="{% url 'news_today' %}"
           class="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-sm hover:shadow-md text-sm sm:text-base
                  {% if time_filter == 'today' %}bg-accent-500 text-white hover:bg-accent-600{% else %}bg-white dark:bg-dark-800 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-dark-700 hover:text-accent-500 dark:hover:text-accent-500 border border-gray-200 dark:border-dark-700{% endif %}
                  transition-all duration-200">
            Today
        </a>
        <a href="{% url 'news_this_week' %}"
           class="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-sm hover:shadow-md text-sm sm:text-base
                  {% if time_filter == 'week' %}bg-accent-500 text-white hover:bg-accent-600{% else %}bg-white dark:bg-dark-800 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-dark-700 hover:text-accent-500 dark:hover:text-accent-500 border border-gray-200 dark:border-dark-700{% endif %}
                  transition-all duration-200">
            This Week
        </a>
        <a href="{% url 'news_this_month' %}"
           class="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-sm hover:shadow-md text-sm sm:text-base
                  {% if time_filter == 'month' %}bg-accent-500 text-white hover:bg-accent-600{% else %}bg-white dark:bg-dark-800 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-dark-700 hover:text-accent-500 dark:hover:text-accent-500 border border-gray-200 dark:border-dark-700{% endif %}
                  transition-all duration-200">
            This Month
        </a>
    </div>

    {% if articles %}
    <!-- Articles List -->
    <div class="space-y-4">
        {% for article in articles %}
        <article class="bg-white dark:bg-dark-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-dark-700 hover:shadow-md transition-shadow">
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-4">
                <div class="flex-1 min-w-0">
                    <h2 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-2">
                        <a href="{{ article.url }}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="hover:text-accent-500 transition-colors">
                            {{ article.title }}
                            <svg class="inline-block w-4 h-4 ml-1 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </a>
                    </h2>
                    {% if article.summary %}
                    <p class="text-gray-600 dark:text-gray-300 text-sm sm:text-base line-clamp-2">
                        {{ article.summary }}
                    </p>
                    {% endif %}
                </div>
            </div>
            <div class="flex items-center gap-3 mt-3 text-sm text-gray-500 dark:text-gray-400">
                <span class="inline-flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                    </svg>
                    {{ article.source_name }}
                </span>
                <span class="inline-flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ article.published_at|timesince }} ago
                </span>
            </div>
        </article>
        {% endfor %}
    </div>

    <!-- Results Count -->
    <div class="text-center text-sm text-gray-600 dark:text-gray-400 mt-8">
        Showing {{ page_obj.start_index }}-{{ page_obj.end_index }}
        of {{ paginator.count }} articles
    </div>

    <div class="mt-10">
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="flex justify-center gap-2 mt-4">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}"
           class="px-3 sm:px-4 py-2 rounded-lg bg-white dark:bg-dark-800 hover:bg-gray-50 dark:hover:bg-dark-700 text-sm sm:text-base transition-colors border border-gray-200 dark:border-dark-700">
            Previous
        </a>
        {% endif %}

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}"
           class="px-3 sm:px-4 py-2 rounded-lg bg-white dark:bg-dark-800 hover:bg-gray-50 dark:hover:bg-dark-700 text-sm sm:text-base transition-colors border border-gray-200 dark:border-dark-700">
            Next
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <!-- No Results -->
    <div class="text-center py-12">
        <p class="text-lg text-gray-600 dark:text-gray-400">
            No news articles found for this time period.
        </p>
        <a href="{% url 'news_archive' %}" class="text-accent-500 hover:text-accent-600 mt-2 inline-block">
            View all news
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
