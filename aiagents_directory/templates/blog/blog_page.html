{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block meta %}
<meta name="description" content="{{ page.intro }}">
<meta name="keywords" content="{% for tag in page.tags.all %}{{ tag }}{% if not forloop.last %}, {% endif %}{% endfor %}, AI agents, artificial intelligence">
<meta name="author" content="{{ page.author }}">
{% endblock %}

{% block social_meta %}
<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:title" content="{{ page.title }}">
<meta property="og:description" content="{{ page.intro }}">
<meta property="article:published_time" content="{{ page.date|date:'c' }}">
<meta property="article:author" content="{{ page.author }}">
{% for tag in page.tags.all %}
<meta property="article:tag" content="{{ tag }}">
{% endfor %}

<!-- If the post has an image, use it for social sharing -->
{% if page.get_first_image %}
    {% image page.get_first_image width-1200 as social_image %}
    <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ social_image.url }}">
    <meta property="og:image:width" content="{{ social_image.width }}">
    <meta property="og:image:height" content="{{ social_image.height }}">
    <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ social_image.url }}">
{% else %}
    <!-- Fallback to default OG image -->
    <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-default-2.png' %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-default-2.png' %}">
{% endif %}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ page.title }}">
<meta name="twitter:description" content="{{ page.intro }}">
{% endblock %}

{% block title %}{{ page.title }} - AI Agents Directory Blog{% endblock %}

<!-- Add structured data for the article -->
{% block extra_head %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "{{ page.title }}",
    "description": "{{ page.intro }}",
    "author": {
        "@type": "Person",
        "name": "{{ page.author }}"
    },
    "publisher": {
        "@type": "Organization",
        "name": "AI Agents Directory",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.png' %}"
        }
    },
    "datePublished": "{{ page.date|date:'c' }}",
    "dateModified": "{{ page.last_published_at|date:'c' }}",
    {% if page.get_first_image %}
    {% image page.get_first_image width-1200 as article_image %}
    "image": "{{ request.scheme }}://{{ request.get_host }}{{ article_image.url }}",
    {% endif %}
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ request.build_absolute_uri }}"
    },
    "keywords": "{% for tag in page.tags.all %}{{ tag }}{% if not forloop.last %}, {% endif %}{% endfor %}",
    "articleSection": "Blog"
}
</script>
{% endblock %}

{% block content %}
<article class="min-h-screen">
    <!-- Breadcrumb -->
    <div class="container mx-auto px-4 py-4">
        <div class="max-w-3xl mx-auto">
            <nav class="flex text-sm">
                <a href="/" class="text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-400">Home</a>
                <span class="mx-2 text-gray-400 dark:text-gray-500">/</span>
                <a href="/blog" class="text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-400">Blog</a>
                <span class="mx-2 text-gray-400 dark:text-gray-500">/</span>
                <span class="text-gray-900 dark:text-white">{{ page.title }}</span>
            </nav>
        </div>
    </div>

    <!-- Header Section -->
    <header class="relative py-12">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto">
                <!-- Title -->
                <h1 class="text-4xl sm:text-5xl font-bold text-gray-900 dark:text-white mb-6">
                    {{ page.title }}
                </h1>

                <!-- Author -->
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-accent-50 dark:bg-accent-900/20 flex items-center justify-center text-accent-700 dark:text-accent-300 text-sm font-medium">
                        {{ page.author|slice:":1" }}
                    </div>
                    <div class="ml-3">
                        <p class="text-base font-medium text-gray-900 dark:text-white">
                            {{ page.author }}
                        </p>
                        <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                            <span>{{ page.date|date:"F j, Y" }}</span>
                            <span>â€¢</span>
                            {% with page.tags.all as tags %}
                            {% if tags %}
                            <div class="flex flex-wrap items-center gap-2">
                                {% for tag in tags %}
                                <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium 
                                           border border-accent-100 dark:border-accent-500/20 
                                           text-accent-600 dark:text-accent-400
                                           bg-accent-50/50 dark:bg-accent-500/5
                                           rounded-md">
                                    {{ tag }}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                </div>

                <!-- Intro -->
                <p class="text-xl text-gray-700 dark:text-gray-300 mb-8">
                    {{ page.intro }}
                </p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4">
        <div class="prose prose-lg dark:prose-invert prose-accent max-w-3xl mx-auto">
            {% for block in page.body %}
                {% if block.block_type == 'paragraph' %}
                    {{ block.value|richtext }}
                {% elif block.block_type == 'image' %}
                    <figure>
                        {% image block.value width-800 class="rounded-lg" %}
                        {% if block.value.caption %}
                            <figcaption class="text-center text-sm text-gray-500 dark:text-gray-400 mt-2">
                                {{ block.value.caption }}
                            </figcaption>
                        {% endif %}
                    </figure>
                {% elif block.block_type == 'heading' %}
                    <h2>{{ block.value }}</h2>
                {% elif block.block_type == 'code' %}
                    <pre><code>{{ block.value }}</code></pre>
                {% elif block.block_type == 'quote' %}
                    <blockquote>{{ block.value }}</blockquote>
                {% else %}
                    {{ block }}
                {% endif %}
            {% endfor %}
        </div>

        <!-- Share Section -->
        <div class="max-w-3xl mx-auto mt-12 mb-12">
            <div class="flex flex-col items-center justify-center p-6 bg-gray-50 dark:bg-dark-800/50 rounded-xl">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                    Share this article
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-6 text-center">
                    If you found this article helpful, please consider sharing it with your network
                </p>
                <div class="flex items-center gap-3">
                    <!-- Twitter/X -->
                    <a href="https://twitter.com/intent/tweet?text={{ page.title|urlencode }}&url={{ request.build_absolute_uri|urlencode }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="inline-flex items-center justify-center px-4 py-2 rounded-lg
                              bg-gray-100 dark:bg-dark-800 
                              text-gray-600 dark:text-gray-400
                              hover:bg-accent-50 dark:hover:bg-accent-900/20 
                              hover:text-accent-600 dark:hover:text-accent-400
                              transition-colors duration-200">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        Share on X
                    </a>

                    <!-- LinkedIn -->
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri|urlencode }}&title={{ page.title|urlencode }}&summary={{ page.intro|urlencode }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="inline-flex items-center justify-center px-4 py-2 rounded-lg
                              bg-gray-100 dark:bg-dark-800 
                              text-gray-600 dark:text-gray-400
                              hover:bg-accent-50 dark:hover:bg-accent-900/20 
                              hover:text-accent-600 dark:hover:text-accent-400
                              transition-colors duration-200">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                        Share on LinkedIn
                    </a>

                    <!-- Copy Link -->
                    <button onclick="copyPageUrl(this)"
                            class="inline-flex items-center justify-center px-4 py-2 rounded-lg
                                   bg-gray-100 dark:bg-dark-800 
                                   text-gray-600 dark:text-gray-400
                                   hover:bg-accent-50 dark:hover:bg-accent-900/20 
                                   hover:text-accent-600 dark:hover:text-accent-400
                                   transition-colors duration-200">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                        </svg>
                        Copy Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Navigation -->
    <footer class="mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-3xl mx-auto flex justify-between text-sm">
                {% if page.get_prev_sibling %}
                <a href="{% pageurl page.get_prev_sibling %}" 
                   class="inline-flex items-center text-accent-600 dark:text-accent-400 hover:text-accent-700 dark:hover:text-accent-300">
                    <svg class="w-4 h-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Previous Post
                </a>
                {% endif %}
                
                {% if page.get_next_sibling %}
                <a href="{% pageurl page.get_next_sibling %}" 
                   class="inline-flex items-center text-accent-600 dark:text-accent-400 hover:text-accent-700 dark:hover:text-accent-300">
                    Next Post
                    <svg class="w-4 h-4 ml-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
    </footer>
</article>

<script>
function copyPageUrl(button) {
    // Copy URL to clipboard
    navigator.clipboard.writeText(window.location.href).then(() => {
        // Change button appearance temporarily
        const originalBg = button.className;
        button.className = button.className + ' bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400';
        
        // Reset after 2 seconds
        setTimeout(() => {
            button.className = originalBg;
        }, 2000);
    });
}
</script>
{% endblock %} 